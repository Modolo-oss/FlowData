version: "3.9"
services:
  coordinator:
    build:
      context: ./backend
    environment:
      - COORDINATOR_PORT=3000
      - WORKER_NODES=http://worker1:3001,http://worker2:3002
      - MAX_UPLOAD_MB=200
      - WALRUS_RPC_URL=${WALRUS_RPC_URL}
      - WALRUS_API_KEY=${WALRUS_API_KEY}
      - SEAL_ENDPOINT=${SEAL_ENDPOINT}
      - SEAL_API_KEY=${SEAL_API_KEY}
      - SUI_NETWORK=${SUI_NETWORK:-testnet}
    ports:
      - "3000:3000"
    command: ["node","dist/coordinator/server.js"]
    depends_on:
      - worker1
      - worker2
  worker1:
    image: python:3.11-slim
    working_dir: /app
    volumes:
      - ./:/app
    environment:
      - WORKER1_PORT=3001
    command: bash -c "pip install -r worker_nodes/worker_1/requirements.txt && python -m worker_nodes.worker_1.main"
  worker2:
    image: python:3.11-slim
    working_dir: /app
    volumes:
      - ./:/app
    environment:
      - WORKER2_PORT=3002
    command: bash -c "pip install -r worker_nodes/worker_2/requirements.txt && python -m worker_nodes.worker_2.main"
  frontend:
    build:
      context: ./frontend
    ports:
      - "5173:80"
    environment:
      - VITE_COORDINATOR_URL=http://localhost:3000
    depends_on:
      - coordinator

